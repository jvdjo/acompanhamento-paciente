databases:
  - name: acompanhamento-db
    plan: free
    region: oregon # optional
    databaseName: acompanhamento_paciente
    user: postgres

services:
  # Backend Service
  - type: web
    name: acompanhamento-api
    plan: free
    runtime: docker
    dockerContext: backend
    dockerfilePath: backend/Dockerfile
    envVars:
      - key: ConnectionStrings__DefaultConnection
        fromDatabase:
          name: acompanhamento-db
          property: connectionString
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: Jwt__Key
        generateValue: true
      - key: Jwt__Issuer
        value: PsicoNotes
      - key: Jwt__Audience
        value: PsicoNotes
      # Note: Google Auth credentials need to be added manually in the dashboard
      - key: Google__ClientId
        sync: false
      - key: Google__ClientSecret
        sync: false
      - key: Cors__AllowedOrigins__0
        value: ${RENDER_EXTERNAL_URL_acompanhamento-web} 

  # Frontend Service (Static Site)
  - type: static
    name: acompanhamento-web
    plan: free
    buildCommand: npm install && npm run build
    publishDir: dist
    root: frontend
    envVars:
      - key: VITE_API_URL
        fromService:
          type: web
          name: acompanhamento-api
          property: url
      - key: VITE_APP_ENV
        value: production
